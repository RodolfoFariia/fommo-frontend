<div class="user-container">

    <div class="user-card">
        <div class="card-header">
            <div class="img-user">
                <img src="images/user-icon.svg" alt="Avatar">
            </div>
            <h2>Minha Conta</h2>
        </div>
    

        <form [formGroup]="userForm" class="user-form">
            <div class="input">
                <label for="">Nome</label>
                <input type="text" formControlName="nome">
            </div>
            <div class="input">
                <label for="">Email</label>
                <input type="text" formControlName="email">
            </div>
            <div class="input">
                <label for="">Data de Nascimento</label>
                <input type="text" formControlName="dataNascimento">
            </div>

            <div class="options">
                @if(!isEditing()){
                    <button type="button" class="btn-edit" (click)="toggleEdit()">
                        Editar Dados
                    </button>

                    <button type="button" class="btn-password" (click)="setChangePassword()">
                        Alterar Senha   
                    </button>

                } @else{
                    <button type="button" class="btn-save"  [disabled]="isLoading()" (click)="saveChanges()">
                        Salvar
                    </button>
                    <button type="button" class="btn-cancel" (click)="toggleEdit()">
                        Cancelar
                    </button>
                }

            </div>
        </form>

        <div class="delete-container">
        <button class="btn-delete" (click)="deleteAccount()">Excluir Conta</button>
        </div>
    </div>

    <div class="avaliacoes-container">
        @if (loadingAvaliacoes()){
            <p>Carregando Avaliacoes...</p>
        }

        @else{
            @for (item of avaliacoesResponse(); track item.id_avaliacao){
                <app-avaliacao-card [avaliacao]="item" (editar)="openModalAvaliacao($event)"></app-avaliacao-card>
            }
        }


    </div>
</div>


@if(changingPassword()){
    <div class="modal" (click)="closePasswordModal()">
        <div class="modal-window" (click)="$event.stopPropagation()">
            <p class="text">Alterando Senha</p>
            <form [formGroup]="passwordForm">
                <label for="">Senha Atual</label>
                <input type="password" formControlName="senha_antiga">

                <label for="">Nova Senha</label>
                <input type="password" formControlName="senha_nova">

                <button type="button" class="btn-modal-cancel" (click)="closePasswordModal()">Cancelar</button>
                <button type="submit" (click)="changePassword()" [disabled]="passwordForm.invalid">Alterar Senha</button>

            </form>
        </div>
    </div>
}



@if(dataEdit() ; as data){
    <app-edicao-modal [dataEdit]="data"></app-edicao-modal>
}
